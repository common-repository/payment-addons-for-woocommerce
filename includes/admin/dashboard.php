<?php

namespace Woo_Stripe_Pay_Addons\Admin;

if (!defined('ABSPATH')) {
  exit; // Exit if accessed directly
}

class Dashboard
{

  public function __construct()
  {
    add_action('admin_menu', array($this, 'addons_menu'), 200);
    add_action('admin_enqueue_scripts', [$this, 'add_admin_dash_assets']);
  }

  public function add_admin_dash_assets()
  {
    if (is_admin() && !empty($_GET['page'])) {
      if(str_contains($_GET['page'], 'woo-pay-addons')) {
        wp_enqueue_script('woo-pay-addons-js', WSPA_ADDONS_ASSET_URL . 'admin/js/admin.js', false, WSPA_PLUGIN_VERSION);
        wp_enqueue_style('woo-pay-addons-css', WSPA_ADDONS_ASSET_URL . 'admin/css/admin.css', false, WSPA_PLUGIN_VERSION);
      }
      if($_GET['page'] == 'wc-settings') {
        wp_enqueue_style('woo-pay-addons-wc-css', WSPA_ADDONS_ASSET_URL . 'admin/css/wc-admin.css', false, WSPA_PLUGIN_VERSION);
      }
    }
  }

  public function addons_menu()
  {
    $sub_page = 'woo-pay-addons';
    $svg_img = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTk5IiBoZWlnaHQ9IjE5OSIgdmlld0JveD0iMCAwIDE5OSAxOTkiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMCA5OS4yNDgxQzAgNDQuNDM3IDQ0LjQyMzkgMCA5OS4yMTg4IDBDMTU0LjAxNCAwIDE5OC40MzggNDQuNDM3IDE5OC40MzggOTkuMjQ4MUMxOTguNDM4IDE1NC4wNTkgMTU0LjAxNCAxOTguNDk2IDk5LjIxODggMTk4LjQ5NkM0NC40MjM5IDE5OC40OTYgMCAxNTQuMDU5IDAgOTkuMjQ4MVpNMTEzLjI3MiAxNDcuNTczQzEyMS4xMTEgMTQ1LjgyNyAxMjcuODMxIDE0Mi4zNzYgMTMyLjk5MiAxMzcuMjU4QzE1MC4xNTIgMTIwLjI0MSAxNDQuOTczIDEwMy42NjEgMTIxLjc0NCA5My4yNTc2QzExNS45NDkgOTAuNjYyIDEwOS44NzIgODguNjIzMyAxMDMuNzcgODYuNTc2QzEwMy4xNTYgODYuMzcgMTAyLjU0MSA4Ni4xNjQgMTAxLjkyNyA4NS45NTczQzk4LjA4MDggODQuNjQ4IDk0LjMzMTYgODMuMTQwNCA5MS4wNjkzIDgwLjk5NzlDODQuNTkzNSA3Ni43OTIzIDg1LjgxMDcgNjkuOTY4MSA5My40MDY1IDY3LjI3MDJDOTUuNTQ4OCA2Ni41MTY0IDk3Ljc4ODYgNjYuMjc4MyAxMDAuMDc3IDY2LjE1OTNDMTAxLjA1MSA2Ni4xMTk2IDEwMi4wNzMgNjYuMDc5OSAxMDMuMDQ3IDY2LjA3OTlDMTEwLjc0IDY2LjA3OTkgMTE4LjA5MyA2Ny40Mjg5IDEyNS4xMDQgNzAuMjA2MkMxMjYuNDY3IDcwLjc2MTYgMTI3LjUzOSA3MS4wMzk0IDEyOC40MTUgNzEuMDM5NEMxMjkuOTczIDcxLjAzOTQgMTMwLjgwMSA3MC4wNDc1IDEzMS42NzcgNjcuOTA1QzEzMi42OCA2NS4zMDg0IDEzMy42MDMgNjIuNjY5IDEzNC41MjUgNjAuMDMzOUMxMzQuODU3IDU5LjA4NTUgMTM1LjE4OSA1OC4xMzc3IDEzNS41MjQgNTcuMTkyNkMxMzYuNCA1NC43NzI1IDEzNS4zMjkgNTMuMTg1NCAxMzIuNTU0IDUyLjE5MzZDMTI3LjQ5IDUwLjM2ODUgMTIyLjI4IDQ5LjA1OTIgMTE2Ljc3OCA0OC4zNDVDMTEyLjk0MiA0Ny44NTYgMTExLjE2MiA0Ny42MjkxIDExMC4zMjggNDYuNjIwMUMxMDkuNjA2IDQ1Ljc0NjIgMTA5LjU5NCA0NC4yODU4IDEwOS41NzIgNDEuNTYwNUwxMDkuNTcyIDQxLjU1NTRDMTA5LjUyMyAzMy41ODU3IDEwOS41MjEgMzMuMjY4NCAxMDAuNDY3IDMzLjI2ODRIOTkuMzQ2N0g5Ni41NzEzSDk0LjkxNTlDOTAuMTQ0MiAzMy4zODc0IDg5LjM2NTEgMzQuMDYxOSA4OS4yMTkxIDM3Ljk1MDFDODkuMTQ2IDM5LjI4OTggODkuMTU1MiA0MC42MDcxIDg5LjE2NDMgNDEuOTE4OUM4OS4xNjczIDQyLjM1NTMgODkuMTcwNCA0Mi43OTExIDg5LjE3MDQgNDMuMjI2OUM4OS4xNzA0IDQ4LjMzMTMgODkuMTIyNyA0OC4zNDUzIDgzLjIyMjUgNTAuMDc1NkM4My4xNjA3IDUwLjA5MzcgODMuMDk4NCA1MC4xMTE5IDgzLjAzNTQgNTAuMTMwNEM2OC4yODIxIDU0LjQ5NDcgNTkuMTc3IDYyLjY2NzkgNTguMjAzMiA3NS43NjA3QzU3LjMyNjcgODcuMzQ1OSA2NC43Mjc3IDk1LjE2MiA3Ni40MTM1IDEwMC44NzVDODEuMzc5MyAxMDMuMzA5IDg2LjY5MiAxMDUuMDQ1IDkyLjAxNyAxMDYuNzg1Qzk0LjQxOTMgMTA3LjU3IDk2LjgyNDEgMTA4LjM1NiA5OS4yMDA2IDEwOS4yMDdDMTAyLjE3MSAxMTAuMjc4IDEwNS4wNDQgMTExLjUwOCAxMDcuNTI3IDExMy4xNzVDMTE0Ljg3OSAxMTguMDk0IDExMy41MTYgMTI2LjMwNyAxMDQuOCAxMjkuNDAyQzEwMS4zNDMgMTMwLjYzMiA5Ny43ODg2IDEzMS4xODcgOTQuMTM2OCAxMzEuMTg3QzkyLjgyMjIgMTMxLjE4NyA5MS41MDc1IDEzMS4xMDggOTAuMTkyOSAxMzAuOTg5QzgyLjM1MzcgMTMwLjE5NSA3NC45MDQgMTI4LjUyOSA2Ny44OTI2IDEyNS41NTNDNjYuMzgzMiAxMjQuOTE5IDY1LjI2MzMgMTI0LjU2MSA2NC4zODY5IDEyNC41NjFDNjIuODc3NSAxMjQuNTYxIDYyLjA0OTcgMTI1LjU5MyA2MS4xNzMzIDEyNy44OTRDNTkuOTU2IDEzMS4wMjkgNTguODg0OCAxMzQuMjAzIDU3LjgxMzYgMTM3LjM3N0M1Ni40MDE2IDE0MS42NjIgNTYuOTM3MiAxNDIuNjUzIDYxLjkwMzcgMTQ0LjYzN0M2OC4yMzM0IDE0Ny4xMzcgNzUuMDUwMSAxNDguNDA2IDgxLjk2NDIgMTQ5LjMxOUM4Ny4zNjg4IDE1MC4wMzMgODcuNTYzNiAxNTAuMTkyIDg3LjYxMjMgMTU0Ljc5NEM4Ny42MTIzIDE1Ni44NTcgODcuNjEyMyAxNTguOTYgODcuNjYxIDE2MS4wMjNDODcuNjYxIDE2My42NDIgODkuMjE5MSAxNjUuMTg5IDkyLjUzIDE2NS4yMjlDOTQuMjgyOSAxNjUuMjY4IDk2LjAzNTggMTY1LjI2OCA5Ny43ODg2IDE2NS4yNjhDOTkuNzg0OSAxNjUuMjY4IDEwMS43ODEgMTY1LjIyOSAxMDMuNzc4IDE2NS4xODlDMTA2Ljg0NSAxNjUuMTEgMTA4LjQ1MiAxNjMuNzYxIDEwOC40NTIgMTYxLjIyMkMxMDguNDY0IDE2MC41MDQgMTA4LjQ4MiAxNTkuNzg4IDEwOC41MDEgMTU5LjA3NEMxMDguNTU2IDE1Ni45NDcgMTA4LjYxIDE1NC44MyAxMDguNTAxIDE1Mi42OTFDMTA4LjMwNiAxNDkuNzk1IDEwOS44NjQgMTQ4LjMyNyAxMTMuMjcyIDE0Ny41NzNaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K';
    add_menu_page(
      esc_html__('Settings', 'woo-pay-addons'),
      esc_html__('Woo Stripe Pay', 'woo-pay-addons'),
      'manage_options',
      $sub_page,
      array($this, 'dashboard'),
      $svg_img,
      58
    );

    add_submenu_page(
      $sub_page,
      esc_html__('Stripe Settings', 'woo-pay-addons'),
      esc_html__('Settings', 'woo-pay-addons'),
      'manage_options',
      'woo-pay-addons-settings',
      [$this, 'dashboard']
    );
  }

  public function header()
  {
?>
    <header class="wspa-nav-bar">
      <ul class="flex">
        <li class="mr-2">
          <a href="?page=woo-pay-addons-settings" class="wspa-nav-item group <?php echo esc_attr($_GET['page'] == 'woo-pay-addons-settings' ? 'active' : ''); ?>" aria-current="page">
            <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path clip-rule="evenodd" fill-rule="evenodd" d="M8.34 1.804A1 1 0 019.32 1h1.36a1 1 0 01.98.804l.295 1.473c.497.144.971.342 1.416.587l1.25-.834a1 1 0 011.262.125l.962.962a1 1 0 01.125 1.262l-.834 1.25c.245.445.443.919.587 1.416l1.473.294a1 1 0 01.804.98v1.361a1 1 0 01-.804.98l-1.473.295a6.95 6.95 0 01-.587 1.416l.834 1.25a1 1 0 01-.125 1.262l-.962.962a1 1 0 01-1.262.125l-1.25-.834a6.953 6.953 0 01-1.416.587l-.294 1.473a1 1 0 01-.98.804H9.32a1 1 0 01-.98-.804l-.295-1.473a6.957 6.957 0 01-1.416-.587l-1.25.834a1 1 0 01-1.262-.125l-.962-.962a1 1 0 01-.125-1.262l.834-1.25a6.957 6.957 0 01-.587-1.416l-1.473-.294A1 1 0 011 10.68V9.32a1 1 0 01.804-.98l1.473-.295c.144-.497.342-.971.587-1.416l-.834-1.25a1 1 0 01.125-1.262l.962-.962A1 1 0 015.38 3.03l1.25.834a6.957 6.957 0 011.416-.587l.294-1.473zM13 10a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            Settings
          </a>
        </li>
        <li class="mr-2">
          <a href="?page=woo-pay-addons" class="wspa-nav-item group <?php echo esc_attr($_GET['page'] == 'woo-pay-addons' ? 'active' : ''); ?>">
            <svg aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
            </svg>
            Payment Methods
          </a>
        </li>
      </ul>
      <h3 class="wspa-nav-bar-heading">
        <svg viewBox="0 0 256 153" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M23.7592 0H232.139C245.326 0 256.002 10.675 256.002 23.863V103.405C256.002 116.592 245.327 127.268 232.139 127.268H157.412L167.669 152.386L122.56 127.268H23.8652C10.6782 127.268 0.00222786 116.593 0.00222786 103.405V23.863C-0.102432 10.78 10.5722 0 23.7592 0Z" fill="#7F54B3" />
          <path d="M14.578 21.7501C16.0349 19.7729 18.2203 18.7322 21.1341 18.5241C26.4414 18.1078 29.4593 20.6054 30.1878 26.0168C33.4138 47.7668 36.952 66.1858 40.6988 81.2758L63.4888 37.8808C65.5701 33.9263 68.1717 31.845 71.2937 31.6369C75.8726 31.3247 78.6823 34.2385 79.827 40.3784C82.4286 54.2194 85.7587 65.9784 89.7132 75.9684C92.4189 49.5354 96.9978 30.4924 103.45 18.7324C105.011 15.8186 107.301 14.3617 110.318 14.1535C112.712 13.9454 114.897 14.6738 116.875 16.2348C118.852 17.7958 119.892 19.773 120.101 22.1665C120.205 24.0397 119.892 25.6006 119.06 27.1616C115.001 34.6543 111.671 47.2466 108.966 64.7286C106.364 81.6916 105.428 94.9076 106.052 104.378C106.26 106.979 105.844 109.269 104.803 111.246C103.554 113.535 101.681 114.784 99.2879 114.992C96.5822 115.2 93.7725 113.952 91.0668 111.142C81.3888 101.256 73.6878 86.4788 68.0688 66.8098C61.3046 80.1298 56.3098 90.1208 53.0838 96.7808C46.944 108.54 41.7408 114.576 37.3698 114.888C34.56 115.096 32.1665 112.702 30.0852 107.707C24.7779 94.0743 19.0542 67.7463 12.9142 28.7223C12.4979 26.0166 13.1223 23.6231 14.5792 21.7499L14.578 21.7501ZM238.218 38.0881C234.472 31.532 228.956 27.5771 221.568 26.0161C219.591 25.5998 217.718 25.3917 215.949 25.3917C205.958 25.3917 197.841 30.595 191.493 41.0017C186.082 49.8472 183.376 59.6297 183.376 70.3477C183.376 78.3607 185.041 85.2287 188.372 90.9527C192.118 97.5088 197.633 101.464 205.021 103.025C206.999 103.441 208.872 103.649 210.641 103.649C220.735 103.649 228.852 98.4458 235.096 88.0391C240.507 79.0895 243.213 69.3071 243.213 58.5891C243.317 50.472 241.548 43.7081 238.218 38.0881ZM225.106 66.9141C223.649 73.7824 221.047 78.8811 217.197 82.3161C214.179 85.0218 211.37 86.1665 208.768 85.6462C206.27 85.1259 204.189 82.9405 202.628 78.882C201.379 75.656 200.755 72.43 200.755 69.4121C200.755 66.8105 200.963 64.2088 201.483 61.8154C202.42 57.5487 204.189 53.3861 206.999 49.4314C210.433 44.3322 214.075 42.2509 217.822 42.9794C220.319 43.4997 222.401 45.6851 223.961 49.7436C225.21 52.9696 225.835 56.1956 225.835 59.2135C225.835 61.9192 225.626 64.5206 225.106 66.9141ZM173.073 38.0881C169.327 31.532 163.707 27.5771 156.423 26.0161C154.446 25.5998 152.573 25.3917 150.803 25.3917C140.813 25.3917 132.696 30.595 126.348 41.0017C120.937 49.8472 118.231 59.6297 118.231 70.3477C118.231 78.3607 119.896 85.2287 123.226 90.9527C126.973 97.5088 132.488 101.464 139.876 103.025C141.854 103.441 143.727 103.649 145.496 103.649C155.59 103.649 163.707 98.4458 169.951 88.0391C175.362 79.0895 178.068 69.3071 178.068 58.5891C178.068 50.472 176.403 43.7081 173.073 38.0881ZM159.857 66.9141C158.4 73.7824 155.799 78.8811 151.948 82.3161C148.93 85.0218 146.12 86.1665 143.519 85.6462C141.021 85.1259 138.94 82.9405 137.379 78.882C136.13 75.656 135.506 72.43 135.506 69.4121C135.506 66.8105 135.714 64.2088 136.234 61.8154C137.171 57.5487 138.94 53.3861 141.75 49.4314C145.184 44.3322 148.826 42.2509 152.573 42.9794C155.07 43.4997 157.152 45.6851 158.712 49.7436C159.961 52.9696 160.586 56.1956 160.586 59.2135C160.69 61.9192 160.377 64.5206 159.857 66.9141Z" fill="white" />
        </svg>
      </h3>
    </header>
  <?php
  }

  public function dashboard()
  {
  ?>
    <div class="wspa-container flex flex-col justify-center border-b border-gray-200 dark:border-gray-700">
      <?php $this->header(); ?>
      <div class="wspa-tabs">
        <?php $_GET['page'] == 'woo-pay-addons' ? include_once(__DIR__ . '/pages/methods.php') : '' ?>
        <?php $_GET['page'] == 'woo-pay-addons-settings' ? include_once(__DIR__ . '/pages/settings.php') : '' ?>
      </div>
    </div>
  <?php
  }
}
